<!DOCTYPE html>
<html>
<head>
   <title>Serving Now - Log in</title>
   <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
   <link rel="stylesheet" href="https://kit-free.fontawesome.com/releases/latest/css/free.min.css">

   <script src="https://unpkg.com/react@16/umd/react.production.min.js" defer></script>
   <script src="https://unpkg.com/react-dom@16/umd/react-dom.production.min.js" defer></script>
   <script src="https://unpkg.com/react-bootstrap@next/dist/react-bootstrap.min.js" defer></script>
   <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js" defer></script>
</head>
<body>
   <div id="login-modal"></div>

   <script type='text/babel' defer>
      const useState = React.useState;
      const BSModules = ['Modal', 'Form', 'InputGroup', 'Button'];
      BSModules.map(module => eval('window.'+module+' = ReactBootstrap.'+module));

      function Login(props) {
         const [pwordHidden, setPwordHidden] = useState(true);
         const [badLogin, setBadLogin] = useState(false);

         const togglePassword = () => {
            var hideIcon = document.querySelector('#hideIcon');
            var pword = document.querySelector('#login-pword');
            if (pwordHidden) {
               hideIcon.className = 'fas fa-eye';
               pword.type = 'text';
            } else {
               hideIcon.className = 'fas fa-eye-slash';
               pword.type = 'password';
            }
            setPwordHidden(!pwordHidden);
         }

         const submitLogin = event => {
            event.preventDefault();
            var form = event.target;
            var email = document.querySelector('#login-email');
            var pword = document.querySelector('#login-pword');
            if (form.checkValidity()) {
               console.log('valid form: email ('+email.value+') password ('+pword.value+')');
               // try login to server, return false if bad credentials
               var loginSuccess = true;
               if (loginSuccess) {
                  window.location = 'index.html';
               } else {
                  setBadLogin(true);
               }
            } else {
               console.log('invalid form');
               form.classList.add('was-validated');
            }
            return false;
         }

         return (
            <Modal show={true}>
               <Modal.Body>
                  <p className='text-danger' hidden={!badLogin}>Invalid login, try again</p>
                  <Form className='d-flex flex-column' id='login-form' onSubmit={submitLogin} noValidate>
                     <Form.Group>
                        <Form.Label>Email</Form.Label>
                        <InputGroup>
                           <InputGroup.Prepend>
                              <InputGroup.Text>
                                 <i className='fas fa-envelope'/>
                              </InputGroup.Text>
                           </InputGroup.Prepend>
                           <Form.Control placeholder='email' id='login-email' required/>
                           <Form.Control.Feedback type="invalid">
                              Enter your email address
                           </Form.Control.Feedback>
                        </InputGroup>
                     </Form.Group>
                     <Form.Group>
                        <Form.Label>Password</Form.Label>
                        <InputGroup>
                           <InputGroup.Prepend>
                              <InputGroup.Text>
                                 <i className='fas fa-key'/>
                              </InputGroup.Text>
                           </InputGroup.Prepend>
                           <Form.Control type='password' placeholder='password' id='login-pword' required/>
                           <InputGroup.Append onClick={togglePassword}>
                              <InputGroup.Text>
                                 <i className='fas fa-eye-slash' id='hideIcon'/>
                              </InputGroup.Text>
                           </InputGroup.Append>
                           <Form.Control.Feedback type="invalid">
                              Enter your password
                           </Form.Control.Feedback>
                        </InputGroup>
                     </Form.Group>
                     <Button type='submit' className='align-self-center w-50'>Log in</Button>
                  </Form>
               </Modal.Body>
            </Modal>
         );
      }

      ReactDOM.render(<Login/>, document.querySelector('#login-modal'));

   </script>

</body>
</html>